<%= render partial: 'spree/admin/shared/order_tabs', locals: { current: Spree.t(:promotions)} %>

<% content_for :page_title do %>
   / <%= Spree.t(:promotions) %>
<% end %>

<% content_for :page_actions do %>
  <%= button_link_to(Spree.t(:add_promotion), "javascript:;", class: "btn-success", data: { toggle: "modal", target: "#addPromotion" }, icon: 'add') if can? :create, Spree::Promotion %>
<% end %>

<div class="modal fade" id="addPromotion" tabindex="-1" role="dialog" aria-labelledby="addPromotionLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addPromotionLabel"><%= Spree.t(:add_promotion) %></h4>
      </div>
      <div class="modal-body">
        <%= form_tag admin_order_apply_promotion_path(@order), method: "POST" do %>
          <div class="form-group">
            <%= select_tag :promotion_id, options_from_collection_for_select(Spree::Promotion.all, :id, :name), class: 'select2' %>
          </div>
          <%= button Spree.t('actions.add'), 'ok', 'submit', { class: 'btn-success' } %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<% if @promotions.any? %>
  <table class="table">
    <thead>
      <tr>
        <th><%= Spree.t(:name) %></th>
        <th><%= Spree.t(:code) %></th>
        <th><%= Spree.t(:description) %></th>
        <th><%= Spree.t(:usage_limit) %></th>
        <th><%= Spree.t(:promotion_uses) %></th>
        <th><%= Spree.t(:expiration) %></th>
        <th class="actions"></th>
      </tr>
    </thead>
    <tbody>
      <% @promotions.each do |promotion| %>
        <tr id="<%= spree_dom_id promotion %>">
          <td><%= link_to promotion.name, edit_admin_promotion_path(promotion) %></td>
          <td><%= promotion.code %></td>
          <td><%= promotion.description %></td>
          <td><%= promotion.usage_limit.nil? ? "âˆž" : promotion.usage_limit  %></td>
          <td><%= Spree.t(:current_promotion_usage, :count => promotion.credits_count) %></td>
          <td><%= promotion.expires_at.to_date.to_s(:short_date) if promotion.expires_at %></td>
          <td class="actions actions-2">
            <%= link_to_with_icon 'delete', Spree.t(:delete), admin_order_delete_promotion_path(@order, promotion_id: promotion.id), class: 'btn btn-danger btn-sm', no_text: true, method: :post %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div class="alert alert-info no-objects-found">
    <%= Spree.t(:no_promotions_found) %>
  </div>
<% end %>
