<div class="row">
  <% Spree::Cms::Sections::ImageCarousel::IMAGE_COUNT.each_with_index do |count, index| %>
    <% img_field = "image_#{count}" %>
    <% title_field = "title_#{count}" %>
    <% link_type_field = "link_type_#{count}" %>
    <% link_field = "link_#{count}" %>

    <div class="col-12 col-md-4 mb-3">
      <div class="card p-3">
        <div class="text-center">
          <h4 class="pb-2"><%= Spree.t("admin.cms.image_carousel.image_#{index}") %></h4>
          <% if @cms_section.try(img_field).attached? %>
            <div id="cms_section_image_<%= count %>_preview">
              <figure class="admin-img-holder mb-0">
                <%= image_tag main_app.url_for(@cms_section.try(img_field).variant(resize: '244x104>')) %>
              </figure>
              <div class="mb-4">
                <%= link_to_with_icon 'delete.svg', Spree.t('delete'), "#!",
                    class: 'btn btn-danger btn-sm _remove_image', data: {count: count} %>
                <%= f.hidden_field "remove_#{count}" %>
              </div>
            </div>
          <% end %>

          <%= f.field_container img_field, class: ['form-group mb-0'] do %>
            <%= f.file_field img_field %>
            <%= f.error_message_on img_field %>
          <% end %>
        </div>

        <small class="text-muted mb-4"><%= Spree.t('admin.cms.image_carousel.aspect_ratio') %></small>

        <%= f.field_container title_field, class: ['form-group'] do %>
          <%= f.label title_field, Spree.t('admin.cms.title') %>
          <%= f.text_field title_field, class: 'form-control' %>
          <%= f.error_message_on title_field %>
        <% end %>

        <div class="col-12"><hr></div>
        <% unless rails_5? %>
          <%= f.field_container link_type_field, class: ['form-group'] do %>
            <%= f.label link_type_field, Spree.t('admin.navigation.link_to') %>
            <%= f.select(link_type_field,
                spree_humanize_dropdown_values('Spree::Cms::Sections::ImageCarousel',
                                                { const: 'LINKED_RESOURCE_TYPE' }),
                                                { include_blank: Spree.t('none') },
                                                class: 'link_switcher',
                                                data: { target_field: link_field}) %>
            <%= f.error_message_on link_type_field %>
          <% end %>
        <% end %>

        <%= render "spree/admin/shared/link_fields",
          resource: @cms_section,
          linked_type: @cms_section.try(link_type_field),
          save_to: link_field, f: f %>
      </div>
    </div>
  <% end %>
</div>

<div class="row pb-0">
  <div class="col-12"> <hr></div>
  <%= f.field_container :fit, class: ['form-group col-6'] do %>
    <%= f.label :fit, Spree.t('admin.cms.fit') %>
    <%= f.select(:fit, @cms_section.boundaries, {include_blank: false}, class: 'select2') %>
    <%= f.error_message_on :fit %>
  <% end %>

  <%= f.field_container :interval, class: ['form-group col-6'] do %>
    <%= f.label :interval, Spree.t('admin.cms.image_carousel.interval') %>
    <%= f.number_field :interval, step: 100, min: 1000, class: 'form-control' %>
    <%= f.error_message_on :interval %>
  <% end %>

  <% %w[controls indicators captions crossfade autoplay pause wrap].each do |field| %>
    <%= f.field_container field, class: ['form-group col-6'] do %>
      <div class="custom-control custom-checkbox">
        <%= f.check_box field, class: 'custom-control-input' %>
        <%= f.label field, Spree.t("admin.cms.image_carousel.#{field}"), class: 'custom-control-label' %>
      </div>
    <% end %>
  <% end %>
</div>

<script>
  $("._remove_image").each(function() {
    const count = $(this).data('count')

    $(this).click(function(evt) {
      $(`#cms_section_image_${count}_preview`).hide()
      $(`#cms_section_remove_${count}`).val(true)
      $(`#cms_section_title_${count}`).val('')
      $(`#cms_section_link_type_${count}`).val('').trigger('change');
    })
  })
</script>
